import numpy as np  # Импорт библиотеки для работы с массивами и математических операций
import matplotlib.pyplot as plt  # Импорт библиотеки для построения графиков
from scipy.io import wavfile  # Импорт функции для чтения WAV файлов

# Чтение WAV файла: функция возвращает частоту дискретизации и аудиосигнал
sampling_freq, signal = wavfile.read('spoken_word.wav')

# Нормализация сигнала: приведение значений к диапазону [-1, 1] для 16-битного аудио
# 2^15 = 32768 (максимальное значение для 16-битного знакового целого)
signal = signal / np.power(2, 15) 

# Определение длины сигнала (количество отсчетов)
len_signal = len(signal)

# Вычисление половины длины сигнала (округление вверх)
# Для быстрого преобразования Фурье достаточно рассматривать половину спектра
# (из-за симметрии для вещественных сигналов)
len_half = np.ceil((len_signal + 1) / 2.0).astype(int)

# Выполнение быстрого преобразования Фурье (FFT) для перехода из временной области в частотную
# Результат - комплексные числа, представляющие амплитуду и фазу частотных составляющих
freq_signal = np.fft.fft(signal)

# Извлечение амплитудного спектра (модуль комплексных чисел)
# Берём только первую половину (положительные частоты) и нормируем на длину сигнала
freq_signal = abs(freq_signal[0:len_half]) / len_signal

# Возведение в квадрат для получения мощности (спектральная плотность мощности)
# Мощность пропорциональна квадрату амплитуды
freq_signal **= 2

# Длина массива спектра мощности
len_fts = len(freq_signal)

# Корректировка мощности с учетом симметрии БПФ:
# Для нечетного числа точек удваиваем все значения, кроме первого (нулевой частоты)
# Для четного числа точек удваиваем все значения, кроме первого и последнего
# Это необходимо, так как мы взяли только половину спектра
if len_signal % 2:
    freq_signal[1:len_fts] *= 2
else:
    freq_signal[1:len_fts-1] *= 2

# Преобразование мощности в децибелы (логарифмическая шкала)
# 10 * log10(x) - стандартная формула для перевода мощности в дБ
signal_power = 10 * np.log10(freq_signal)

# Создание частотной оси в кГц для построения графика
# Каждая точка спектра соответствует определенной частоте:
# частота = (индекс * частота_дискретизации) / длина_сигнала
x_axis = np.arange(0, len_half, 1) * (sampling_freq / len_signal) / 1000.0

# Построение графика спектра мощности
plt.figure()
plt.plot(x_axis, signal_power, color='black')  # Черный график зависимости мощности от частоты
plt.xlabel('Частота (кГц)')  # Подпись оси X (частота в килогерцах)
plt.ylabel('Мощность сигнала (дБ)')  # Подпись оси Y (мощность в децибелах)
plt.show()  # Отображение графика